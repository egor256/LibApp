<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
      layout:decorate="~{layout}">
    <div layout:fragment="page_content" id="page_content">
        <div class="error" th:if="${param.error}">
            Invalid search string: should be 3 or more characters!
        </div>
        <div sec:authorize="hasRole('LIBRARIAN')">
            <a th:href="@{/books/add}">Add new book</a>
        </div>
        <form th:action="@{/books}" th:object="${filter}" method="post">
            <span th:each="checkboxValue, iterStat : ${allTags}">
                    <input type="checkbox" th:field="*{selectedTags}" th:value="${checkboxValue}"/>
                    <label th:for="${#ids.prev('selectedTags')}" th:text="${checkboxValue}"></label>
                    <br th:if="(${iterStat.index} + 1) % 4 == 0 and !${iterStat.last}">
            </span>
            <br>
            <input type="text" placeholder="Search string" th:field="*{searchString}" />
            <button type="submit">OK</button>
        </form>
        <table>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Author</th>
                <th>Tags</th>
                <th>Quantity</th>
                <th></th>
                <th sec:authorize="hasRole('LIBRARIAN')"></th>
            </tr>
            <tr th:each="book : ${books}">
                <td th:text="${book.id}"></td>
                <td th:text="${book.name}"></td>
                <td th:text="${book.author}"></td>
                <td>
                    <span th:each="tag, iterStat : ${book.tags}" th:text="!${iterStat.last} ? ${tag} + ', ' : ${tag}"></span>
                </td>
                <td th:text="${book.quantity}"></td>
                <td sec:authorize="!hasRole('LIBRARIAN')"><span th:if="${book.quantity} > 0"><a th:href="@{/order(bookId=${book.id})}">Order</a></span></td>
                <td sec:authorize="hasRole('LIBRARIAN')"><a th:href="@{/books/update(bookId=${book.id})}">Update</a></td>
                <td sec:authorize="hasRole('LIBRARIAN')"><a th:href="@{/books/delete(bookId=${book.id})}">Delete</a></td>
            </tr>
        </table>
    </div>
</html>
